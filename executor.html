<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Lua Editor</title>
    
    <!-- CodeMirror 6 Dependencies -->
    <script type="module">
        import { EditorView, basicSetup } from "https://codemirror.net/6/examples/bundle.js";
        import { LRLanguage, LanguageSupport, syntaxTree } from "@codemirror/language";
        import { styleTags, tags } from "@lezer/highlight";
        import { HighlightStyle } from "@codemirror/language";
        import { oneDark } from "@codemirror/theme-one-dark";
        import { autocompletion } from "@codemirror/autocomplete";

        // ðŸ”¹ Custom Lua Syntax Highlighter
        const luaHighlightStyle = HighlightStyle.define([
            { tag: tags.keyword, color: "#ff79c6" }, // Keywords
            { tag: tags.comment, color: "#6272a4" }, // Comments
            { tag: tags.string, color: "#f1fa8c" }, // Strings
            { tag: tags.number, color: "#bd93f9" }, // Numbers
            { tag: tags.variableName, color: "#50fa7b" }, // Variables
            { tag: tags.operator, color: "#ffb86c" }, // Operators
        ]);

        // ðŸ”¹ Custom Lua Language Definition
        const luaLanguage = LRLanguage.define({
            parser: new (class {
                parse(input) {
                    return {
                        toTree: () => syntaxTree(input),
                    };
                }
            })(),
            languageData: {
                commentTokens: { line: "--" },
            },
        });

        // ðŸ”¹ Lua Autocomplete Suggestions
        const luaCompletions = [
            { label: "print", type: "function", info: "print(value)" },
            { label: "function", type: "keyword" },
            { label: "local", type: "keyword" },
            { label: "if", type: "keyword" },
            { label: "then", type: "keyword" },
            { label: "end", type: "keyword" },
            { label: "while", type: "keyword" },
            { label: "repeat", type: "keyword" },
            { label: "until", type: "keyword" },
            { label: "return", type: "keyword" },
            { label: "true", type: "constant" },
            { label: "false", type: "constant" },
            { label: "nil", type: "constant" },
        ];

        const luaAutocomplete = autocompletion({
            override: [context => {
                let word = context.matchBefore(/\w*/);
                if (!word || word.from === word.to) return null;
                return {
                    from: word.from,
                    options: luaCompletions,
                    validFor: /^\w*$/,
                };
            }],
        });

        // ðŸ”¹ Create Editor
        new EditorView({
            doc: "-- hello",
            extensions: [
                basicSetup,
                new LanguageSupport(luaLanguage, [luaHighlightStyle]),
                oneDark,
                luaAutocomplete,
            ],
            parent: document.body,
        });
    </script>

    <style>
        body { margin: 0; background: #282a36; height: 100vh; display: flex; align-items: center; justify-content: center; }
        .cm-editor { width: 100%; height: 100vh; font-size: 16px; }
    </style>
</head>
<body></body>
</html>
